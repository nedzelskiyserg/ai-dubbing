name: Build Electron App (AI Dubbing Studio)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    # 1. –°–∫–∞—á–∏–≤–∞–µ–º –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Node.js
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python 3.10 –¥–ª—è —Å–±–æ—Ä–∫–∏ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 4. –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞ (–ë–ï–ó–û–ü–ê–°–ù–û - —Ç–æ–∫–µ–Ω –∏–∑ GitHub Secrets)
    - name: Create .env file from GitHub Secret
      shell: pwsh
      run: |
        if ($env:HF_TOKEN -and $env:HF_TOKEN -ne "") {
          # –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Å–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞
          # –í–ê–ñ–ù–û: –¢–æ–∫–µ–Ω –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é GitHub Secrets
          # GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å–∫–∏—Ä—É–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –≤ –ª–æ–≥–∞—Ö
          "HF_TOKEN=$env:HF_TOKEN" | Out-File -FilePath .env -Encoding utf8
          Write-Host "‚úÖ .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏–∑ GitHub Secret"
          Write-Host "‚úÖ –¢–æ–∫–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω (–Ω–µ –≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö)"
        } else {
          Write-Host "‚ö†Ô∏è HF_TOKEN —Å–µ–∫—Ä–µ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ GitHub Secrets"
          Write-Host "‚ÑπÔ∏è  –î–∏–∞—Ä–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Ç–æ–∫–µ–Ω–∞"
          Write-Host "‚ÑπÔ∏è  –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏: Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret"
          Write-Host "‚ÑπÔ∏è  –ò–º—è —Å–µ–∫—Ä–µ—Ç–∞: HF_TOKEN"
          # –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π .env —Ñ–∞–π–ª, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫
          "" | Out-File -FilePath .env -Encoding utf8
        }
      env:
        # –ë–ï–ó–û–ü–ê–°–ù–û: GitHub Secrets –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
        # –¢–æ–∫–µ–Ω –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –ª–æ–≥–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏–ª–∏ –∫–æ–¥
        HF_TOKEN: ${{ secrets.HF_TOKEN }}

    # 5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
    - name: Install Node.js dependencies
      working-directory: ./frontend
      run: npm install

    # 6. –°–æ–±–∏—Ä–∞–µ–º React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    - name: Build React app
      working-directory: ./frontend
      run: npm run build
      env:
        CI: false
        GENERATE_SOURCEMAP: false

    # 7. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏—è venv)
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 8. –°–∫–∞—á–∏–≤–∞–µ–º FFmpeg –¥–ª—è Windows (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
    - name: Download FFmpeg
      shell: pwsh
      run: |
        Write-Host "üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ FFmpeg (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)..."
        New-Item -ItemType Directory -Force -Path ffmpeg | Out-Null
        
        try {
          Invoke-WebRequest -Uri "https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip" -OutFile "ffmpeg.zip" -TimeoutSec 300
          Write-Host "‚úÖ FFmpeg —Å–∫–∞—á–∞–Ω"
        } catch {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å FFmpeg"
          Write-Host "–û—à–∏–±–∫–∞: $_"
          exit 1
        }
        
        try {
          Expand-Archive -Path ffmpeg.zip -DestinationPath ffmpeg_temp -Force
          # –ö–æ–ø–∏—Ä—É–µ–º ffmpeg.exe –∏–∑ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–π –ø–∞–ø–∫–∏
          $ffmpegPath = Get-ChildItem -Path ffmpeg_temp -Recurse -Filter ffmpeg.exe | Select-Object -First 1
          
          if (-not $ffmpegPath) {
            Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ffmpeg.exe –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∞—Ä—Ö–∏–≤–µ"
            exit 1
          }
          
          Copy-Item $ffmpegPath.FullName -Destination ffmpeg\ffmpeg.exe
          # –¢–∞–∫–∂–µ –∫–æ–ø–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ DLL —Ñ–∞–π–ª—ã
          $dllFiles = Get-ChildItem -Path $ffmpegPath.DirectoryName -Filter *.dll
          foreach ($dll in $dllFiles) {
            Copy-Item $dll.FullName -Destination ffmpeg\
          }
          Write-Host "‚úÖ FFmpeg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"
        } catch {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å FFmpeg"
          Write-Host "–û—à–∏–±–∫–∞: $_"
          exit 1
        }
        
        # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        if (-not (Test-Path "ffmpeg\ffmpeg.exe")) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ffmpeg.exe –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏"
          exit 1
        }
        Write-Host "‚úÖ FFmpeg —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω"

    # 9. –ö–æ–ø–∏—Ä—É–µ–º FFmpeg –≤ build –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
    - name: Copy FFmpeg to build directory
      shell: pwsh
      run: |
        if (-not (Test-Path "ffmpeg\ffmpeg.exe")) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ffmpeg.exe –Ω–µ –Ω–∞–π–¥–µ–Ω!"
          Write-Host "FFmpeg –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
          exit 1
        }
        
        Write-Host "üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ FFmpeg –≤ build –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é..."
        New-Item -ItemType Directory -Force -Path frontend/build/ffmpeg | Out-Null
        Copy-Item -Path ffmpeg\* -Destination frontend/build/ffmpeg\ -Recurse -Force
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã
        if (-not (Test-Path "frontend\build\ffmpeg\ffmpeg.exe")) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å FFmpeg"
          exit 1
        }
        
        Write-Host "‚úÖ FFmpeg —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ build –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é"

    # 10. –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º Python backend —Å PyInstaller (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ù—É–∂–µ–Ω Python 3.10‚Äì3.12, –Ω–µ 3.14 ‚Äî whisperx –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3.14)
    - name: Package Python backend
      shell: pwsh
      env:
        PYTHONUTF8: 1   # —á—Ç–æ–±—ã pip —á–∏—Ç–∞–ª requirements.txt –≤ UTF-8 (–∏–Ω–∞—á–µ UnicodeDecodeError –Ω–∞ Windows)
      run: |
        Write-Host "üî® –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É Python backend (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)..."
        python --version
        if (-not ($(python --version 2>&1) -match "3\.(10|11|12)\.")) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù—É–∂–µ–Ω Python 3.10, 3.11 –∏–ª–∏ 3.12 (whisperx –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3.14)"
          exit 1
        }
        if (-not (Test-Path "build-python-backend.ps1")) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –°–∫—Ä–∏–ø—Ç build-python-backend.ps1 –Ω–µ –Ω–∞–π–¥–µ–Ω!"
          exit 1
        }
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É
        $buildResult = & .\build-python-backend.ps1
        $buildExitCode = $LASTEXITCODE
        
        if ($buildExitCode -ne 0) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –°–±–æ—Ä–∫–∞ Python backend –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π (–∫–æ–¥: $buildExitCode)"
          Write-Host "Python backend –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
          exit 1
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏
        $backendExe = "frontend\build\python-backend\api-server\api-server.exe"
        if (-not (Test-Path $backendExe)) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: Python backend –Ω–µ —Å–æ–±—Ä–∞–Ω!"
          Write-Host "–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $backendExe"
          Write-Host "Python backend –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
          exit 1
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0)
        $fileSize = (Get-Item $backendExe).Length
        if ($fileSize -eq 0) {
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: Python backend —Å–æ–±—Ä–∞–Ω, –Ω–æ —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π!"
          exit 1
        }
        
        Write-Host "‚úÖ Python backend —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω (—Ä–∞–∑–º–µ—Ä: $([math]::Round($fileSize/1MB, 2)) MB)"

    # 11. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π Electron
    - name: Verify required components
      shell: pwsh
      working-directory: ./frontend
      run: |
        Write-Host "üîç –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤..."
        Write-Host "–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(Get-Location)"
        
        $errorList = @()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º electron/main.js (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ frontend/)
        $electronMain = "electron\main.js"
        if (-not (Test-Path $electronMain)) {
          $errorList += "‚ùå electron/main.js –Ω–µ –Ω–∞–π–¥–µ–Ω: $electronMain"
          Write-Host "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
          Get-ChildItem | Select-Object -First 10 | ForEach-Object { Write-Host "  $($_.Name)" }
        } else {
          Write-Host "‚úÖ electron/main.js –Ω–∞–π–¥–µ–Ω: $electronMain"
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º Python backend (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ frontend/build/)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç–∏
        $backendExe1 = "build\python-backend\api-server.exe"
        $backendExe2 = "build\python-backend\api-server\api-server.exe"
        
        $backendExe = $null
        if (Test-Path $backendExe1) {
          $backendExe = $backendExe1
        } elseif (Test-Path $backendExe2) {
          $backendExe = $backendExe2
        }
        
        if (-not $backendExe) {
          $errorList += "‚ùå Python backend –Ω–µ —Å–æ–±—Ä–∞–Ω: –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ $backendExe1, –Ω–∏ $backendExe2"
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –µ—Å—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
          $backendDir = "build\python-backend"
          if (Test-Path $backendDir) {
            Write-Host "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ $backendDir :"
            Get-ChildItem $backendDir -Recurse | Select-Object -First 30 | ForEach-Object { 
              $type = if ($_.PSIsContainer) { "DIR" } else { "FILE" }
              Write-Host "  [$type] $($_.FullName)"
            }
          } else {
            Write-Host "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è $backendDir –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
            Write-Host "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ build/:"
            if (Test-Path "build") {
              Get-ChildItem "build" | Select-Object -First 10 | ForEach-Object { Write-Host "  $($_.Name)" }
            }
          }
        } else {
          $size = (Get-Item $backendExe).Length
          Write-Host "‚úÖ Python backend –Ω–∞–π–¥–µ–Ω (—Ä–∞–∑–º–µ—Ä: $([math]::Round($size/1MB, 2)) MB): $backendExe"
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º FFmpeg (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ frontend/build/)
        $ffmpegExe = "build\ffmpeg\ffmpeg.exe"
        if (-not (Test-Path $ffmpegExe)) {
          $errorList += "‚ùå FFmpeg –Ω–µ –Ω–∞–π–¥–µ–Ω: $ffmpegExe"
        } else {
          Write-Host "‚úÖ FFmpeg –Ω–∞–π–¥–µ–Ω: $ffmpegExe"
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º React build (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ frontend/build/)
        $reactBuild = "build\index.html"
        if (-not (Test-Path $reactBuild)) {
          $errorList += "‚ùå React build –Ω–µ –Ω–∞–π–¥–µ–Ω: $reactBuild"
        } else {
          Write-Host "‚úÖ React build –Ω–∞–π–¥–µ–Ω: $reactBuild"
        }
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - –∑–∞–≤–µ—Ä—à–∞–µ–º —Å –æ—à–∏–±–∫–æ–π
        if ($errorList.Count -gt 0) {
          Write-Host ""
          Write-Host "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:"
          foreach ($err in $errorList) {
            Write-Host "  $err"
          }
          Write-Host ""
          Write-Host "–°–±–æ—Ä–∫–∞ Electron –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –±–µ–∑ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤!"
          exit 1
        }
        
        Write-Host ""
        Write-Host "‚úÖ –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Å–±–æ—Ä–∫–µ"

    # 12. –°–æ–±–∏—Ä–∞–µ–º Electron –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ë–ï–ó –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ npm run build ‚Äî React —É–∂–µ —Å–æ–±—Ä–∞–Ω –≤ —à–∞–≥–µ 6,
    #     python-backend –∏ ffmpeg –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ frontend/build –≤ —à–∞–≥–∞—Ö 9‚Äì10; dist:win –¥–µ–ª–∞–µ—Ç build –∏ –∑–∞—Ç–∏—Ä–∞–µ—Ç build/)
    - name: Build Electron app
      working-directory: ./frontend
      run: |
        Write-Host "üî® –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É Electron –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
        npx electron-builder --win
        
        Write-Host "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
        Get-ChildItem -Path dist-electron -Filter *.exe | ForEach-Object {
          Write-Host "  ‚úÖ $($_.Name) ($([math]::Round($_.Length/1MB, 2)) MB)"
        }
      env:
        ELECTRON_BUILDER_CACHE: ${{ runner.temp }}/electron-builder-cache
        CI: false

    # 13. –ó–∞–≥—Ä—É–∂–∞–µ–º Portable –≤–µ—Ä—Å–∏—é (–æ–¥–∏–Ω EXE —Ñ–∞–π–ª, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
    - name: Upload Windows Portable (Single EXE)
      uses: actions/upload-artifact@v4
      with:
        name: AI-Dubbing-Studio-Windows-Portable
        path: frontend/dist-electron/*Portable*.exe
        retention-days: 30
        if-no-files-found: error

    # 14. –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ (NSIS)
    - name: Upload Windows Installer
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: AI-Dubbing-Studio-Windows-Installer
        path: frontend/dist-electron/*Setup*.exe
        retention-days: 30
        if-no-files-found: warn

    # 15. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–∫–∂–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    - name: Upload Windows Unpacked
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: AI-Dubbing-Studio-Windows-Unpacked
        path: frontend/dist-electron/win-unpacked
        retention-days: 7
        if-no-files-found: warn
